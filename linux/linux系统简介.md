# UNIX 与 Linux 发展史

## 主流的 UNINX 发行版

![主流的UNIX发行版](https://lalala-1252702812.cos.ap-shanghai.myqcloud.com/article/20200225132153.png)
IBM 的 AIX 操作系统目前在国内的服务器领域一家独大。

硬件平台就是指 CPU,除了常用的 AMD,CPU,还有很多种类的 CPU.

Solaris 是可以在个人用户电脑上安装的,是最容易上手使用的.

UNIX 是很贵的,只有很大的公司才能买得起.

Linux BSD 代表的就是伯克利大学

Linux 和 MacOs 都是称为**类 UNIX 系统**，都是 UNIX 基础的.

C 语言的发展极大的促进了 UNIX 的诞生.

## Linux 的发展历史

Linux 诞生于 1991 年,是由 Linus torvalds 和后续的开发者共同开发的.

Linux 内核官网,www.kernel.org

**内核版和开发版**:内核版是指 Linux 内核,开发版是各大厂商自己加入自己的东西,建立在内核版的基础上的.

目前的两大分支是 redhat 和 Debian 类型,两者的区别在于软件安装的方式不一样.

![分支和衍生的发行版本](https://lalala-1252702812.cos.ap-shanghai.myqcloud.com/article/20200225133806.png)

## 开源技术

支持互联网的开源技术,目前主流的网站建设

![](https://lalala-1252702812.cos.ap-shanghai.myqcloud.com/article/20200225145127.png)

## 学习方法

1. 自己思考问题,自己思考的过程是加深印象的过程;
2. 善于使用帮助文档;
3. 学会搜索;
4. 学会问问题,描述清楚问题.

忘记 windows 的思维,学习 Linux 的思维.

书籍资料不要多在意,要精进研究内容,不要重视哪个好哪个不好.

**计划,专注,坚持,练习**

坚持一步一步的走,不要想之后的问题,要开始基础的过程,相信基础的累积才能有更好的决定,更好的想法.专注于聚集一点,才能做成事情.

练习,一定要练习两遍,成果的体现,才能让自己不断坚持下去.

## 文件系统

win 能识别的 FAT16,FAT32 和 NTFS.

Linux 可以识别 exft2,exft3,esft4.

linux 中一切设备都是文件,挂载在/dev/下,`/`表示 Linux 下根目录,是所有文件所在的地方,

`/dev/sda1`分区设备文件名,`/dev/sd`代表 sata 串口接口硬盘,是硬件,之后的 a 代表第几个硬盘,最后的 1 代表的就是硬盘里的分区了.

`eth`就代表网卡设备

`1,2,3,4`只能给主分区和扩展分区,之后的`5,6,`代表逻辑分区,逻辑分区永远都是从 5 开始.[主分区,扩展分区,逻辑分区](https://baike.baidu.com/item/%E9%80%BB%E8%BE%91%E5%88%86%E5%8C%BA/2588209?fr=aladdin).

MBR 分区表可以划分出 4 个主分区,GPT 可以划分 128 个主分区(win10).只能在扩展分区的基础上建立逻辑分区.主分区就是系统认识的作为系统启动的分区,就是所谓的引导分区.而传统的 C,D,E 等盘就是所谓的逻辑分区了.

**挂载**,就是把分配的盘`sda1`等等,标记名字,称为**挂载点**,就是`/(根分区),swap(交换分区),/boot(启动分区)`.

## 注意事项

1. 命令严格区分大小写,命令全部都是小写.文件名称也区分大小写.
2. linux 一切皆是文件,所有的设备都是文件.想永久生效的都是得需要文件配置.
3. Linux 不以扩展名区分文件,依赖文件权限来区分文件.扩展名都是帮助区分文件的,类似的`.sh`,`.conf`,`.gz`.
4. linux 所有的存储设备必须挂载之后才能使用.
5. 使用 Linux 就要改变思路,把它当作一个服务器系统,是一个团队的共同产品,一定要谨慎每一步的操作,遵守规范.

**服务器**

1. 服务器不允许关机,只能重启;
2. 重启时应该关闭服务;
3. 不要在访问高峰执行搞负载命令;
4. 远程配置防火墙时主要不要把自己踢出服务器;
5. 指定合理的密码规范并定期更新;
6. 合理分配权限,越小越好;
7. 定期备份重要数据和日志.**非常重要**.

## Linux 各目录的作用

linux 是一个严谨的系统,每个系统文件都有自己的作用,应该遵守这个规范.

![各目录的作用](https://lalala-1252702812.cos.ap-shanghai.myqcloud.com/article/20200225182459.png)
![](https://lalala-1252702812.cos.ap-shanghai.myqcloud.com/article/20200225183217.png)
![](https://lalala-1252702812.cos.ap-shanghai.myqcloud.com/article/20200225184931.png)
`bin`就代表二进制的意思,可执行文件命令.类似前四个目录

**单用户模式**类似于 win 的安全模式,修复时用的.

`usr`并不是 user,不是用户的意思.是系统资源路径文件夹.Unix system resource

`/home`是家目录,每个用户的都会在家目录下默认新建一个自己的家目录

`opt`现在更多应用`usr/local`存放文件

`tmp` 临时文件目录,用的挺多的

**虚拟文件系统**就是存放到内存里面的文件,写入到里面,关机就没了.

# 配置网络

ifconfig (internet face config) 查看配置网卡的命令

```bash
ifconfig eth0 192.168.2.1
```

虚拟机桥接模式是直接使用主机的物理网卡，需要占用一个 IP 地址。
NAT 模式是借用主机的虚拟网卡 Vmnet8,只要设置 ip 地址就可以局域网访问了
仅主机，就是使用 vmnet1，一样的。

# linux 常用命令

linux 有多达几千个命令,每个命令都有多个选项,不可能都学会.

## 命令格式

命令 [-选项][参数]

有简化选项和完整选项,简化选项一个-,完整选项一般是--,是彼此相等的.

中括号的意思代表可有可无,要注意.

多个选项可以写在一起.多数选项都是没顺序的,有些有一定的顺序.

例如 `ls -a /etc`

## 文件处理命令

- `ls` -[ald] list,显示文件的命令
  - `-a` 所有文件 all
  - `-l` 详细信息 long
  - `-d` 只显示当前目录名
  - `-h` 人性化,自动显示文件大小的,很多设计文件大小的都有这个

==隐藏文件==的设立目的不是让人找不到,设立初衷是告诉用户这是系统文件,一般不要修改.🎅

![](https://lalala-1252702812.cos.ap-shanghai.myqcloud.com/article/20200225191849.png)

- `-rw-r--r--` 10 个字符,多个指代信息
  - `-` 文件类型(- 二进制文件,d 目录,l 软连接文件,还有别的文件类型)
  - `rw-` 权限(r,read w,write x,run)三个字符一个段,三段分别对应 u,g,o 三个用户类型.x 权限是最高权限,当需要运行的时候再给,权限越小越好
- `1` 代表引用系数,使用过多少次
- `root` 代表所有者用户,只能有一个.有所属者(user,U),所属组(Group,G),和其他(Other)
- `root` 第四部分代表所属组
  所属组,多个相同类型的用户组成的一个组.
- `1205` 文件大小,字节单位
- `3月 3 08:10` 最后一次修改时间

## 目录处理命令

- `mkdir` 创建文件夹命令
  - `-p` 逐级递归创建新目录,
- `cd` 切换目录
- `pwd` 显示当前路径
- `rmdir` 删除空目录.用的不多,太麻烦了
- `cp` 复制命令

  - `r` 复制目录
  - `p` 保留文件属性,比如最后访问时间
    参数:源文件或目录 目标目录

  复制的同时可以改名,就直接目标目录改成想要的文件名就可以

- `mv` 剪切和改名
- `rm` 删除文件
  - `-r` 删除目录
  - `-f` 强制执行,不再再次确认

## 文件处理命令

- `touch` 创建文件
  文件名字中空格不推荐使用,因为空格在命令当中作为分隔符,比如`touch progrma file` 系统会认为创造两个文件.正确做法是要用引号来引起来,但这样太麻烦了,因此不建议使用空格包含在名字中.
- `cat` 浏览文件内容
  - `-n` 显示行号
- `tac` 反过来写,反向显示文件内容
- `more` 分页显示文件内容,用于 cat 文件内容很长,无法完全显示.
  - 空格或 f: 翻页
  - 回车: 换行翻
  - q: 退出
- `less` 可以向上翻页,强化版的 more 命令
  - pageup: 往上翻
  - 上箭头: 也可以
  - /: 可以进行搜索
- `head` 只看前几行,看脚本很有用
  - `-n` 指定显示的行数
- `tail` 相应的功能
  - `-f` 动态显示内容,监控程序的日志文件内容

## 链接命令

- `ln` 生成链接文件
  - `-s` 创建软连接

格式：ln 源文件 链接文件

不加 s 就是硬链接

软连接文件就是相当于 win 的快捷方式，软连接的权限不决定源文件的权限。

软连接的权限都是最高权限，这是一个特点。

硬链接产生文件和源文件是一样的，相当于保留文件属性的复制，是完全一样的。

不同点在于，可以**同步更新**。

源文件即使丢失，硬链接依然存在，软链接就访问不到文件了

怎么判断硬链接呢：可以通过 i 节点来判断，即`ls -i 源文件 硬链接` 两个是相同的 i 节点。i 节点可以映射多个文件，可以同步更新。

什么时候用硬链接：协同操作，相当于有备份，可以同步更新。

硬链接，不可以跨分区链接。不可以针对目录来使用。

写入 `echo` 命令

## 权限管理命令

- `chmod`

  - `chmod [{ugoa}{+-=}{rwx}][文件目录]`
    第一个就是用户的三种类型和所有用户  
    `chmod u+x list` 给用户一个执行的权限
    `chmod g+w,o-r wenjian` 多个操作用逗号间隔
    `=`的意思就说不管之前是什么权限，现在都变成等号后的权限
  - 一般用数字来表示，4 代表 r，2 代表 w，1 代表 x，7 就是最高权限。`532`就对应的`r-x-wx-w-`.
    `chmod 640 wenjian`一般这么用
  - `-R` 递归修改，改变所有子目录的权限。
  - **文件权限只能 root 和所有者来更改**

- `chown` 更改文件的所有者
  - `chown [用户] [文件目录]`
  - **改变所有者只能由 root 来改**
  - 更改了所有者，所有者就拥有了所有的权限
- `chgrp` 更改文件的所属组
  - `chgrp group file`
  - 更改组，组里所有的用户都有相应的权限。

谁创建了文件，谁就是所有者。一个用户可以属于多个组，但有一个缺省组，所属组就是相应的缺省组。

- `umask` 显示，设置文件的缺省权限，就是默认创建文件是带有的权限
  - `umask -S` 以 rwx 的形式显示默认创建的权限
  - `umask` 数字显示，一般是 0022，第一个是特殊权限，后面是权限掩码，用 777 减去这个值就是对应的权限了
  - `umask 023` 设置默认创建文件的权限
  - 只是目录，不是文件，新建的文件都是不可执行的，为了安全。

## 文件和目录权限不同的含义

![](https://lalala-1252702812.cos.ap-shanghai.myqcloud.com/article/20200226104129.png)

**对一个文件有写权限，只是可以修改文件。但是删除这个文件，需要对目录有些权限。**

目录的`rx`权限是同时的，不能只能 ls，不能 cd。或者反过来也不行。

- `useradd` 添加用户
  - `useradd aatrox`
    `passwd aatrox`
- `groupadd` 添加组

## 文件查找命令

少用搜索，会占用大量的系统资源，要尽量把文件目录规划好。

- `find [搜索范围] [匹配条件]` 搜索命令

  - `find /etc -name init` 根据名字搜索，精准搜索，多少一个字符都不行
    - `find /etc -name *init*` 使用通配符来搜索
    - `-iname` 忽略大小写的搜索
  - `-size` 根据文件大小来查找
    - `find /etc -size +(-, )204800` 查找，加号大约，减号小于，什么都不用等号。
      1KB 是两个数据块，一个数据块是 512 字节，所以**100Mb=102400Kb=204800 字节**
  - `-user` 根据所有者来查找
  - `-group` 根据所属组来查找
  - `-amin -cmin -mmin` access,访问 change 文件属性的改变 modify 文件内容的改变
    - `find /etc -cmin -5`查找五分钟文件属性改变的文件
  - `-a -o`and 两个条件都满足，放在两个条件中间；or 一个就可以
  - `-type` 根据文件类型查找，f 文件，d 目录，l 软连接文件
  - `-exec command {} \;`对查找的结果执行命令 exec 可以换成 ok，询问命令是不是要执行。
  - `-inum` 根据文件 i 节点来查找，文件名比较复杂时候用，查找硬链接时有用。

- `locate filename` 快速搜索，在文件资料库当中搜索,不是全盘搜索，系统会定期的把文件收录到资料文件库当中，然后只在这一个地方搜索,`/tem`这个文件夹里面不会被收录。`-i` 忽略大小写。
- `updatedb` 更新文件资料库
- `which command` 搜索命令所在目录及别名信息`alias`
- `whereis` 搜索命令所在目录及帮助文档
- `grep string file` 在文件内容中搜索字符串匹配的行显示出来，以行为单位的
  - `-i` 不区分大小写
  - `-v` 排除指定字符串，去掉注释行时的有用
    - `grep -v ^# /etc/inittab` 排除以井号开头的行，第一个字符是代表行首的正则

## 帮助命令

- `man` 帮助命令
  帮助命令不仅可以看命令，还可以看配置文件的帮助
  主要关注 name 下的介绍和格式，选项
  可以用/搜索关键词
  查看配置文件的帮助需要
  `man services 不能 man /etc/services`使用绝对路径来查看，需要直接用名字
  主要关注 格式和干什么用的
  ![](https://lalala-1252702812.cos.ap-shanghai.myqcloud.com/article/20200227093026.png)
  帮助文档优先查看命令的，像 passwd，既有命令，也有配置稳定，可以通过`whereis passwd`来查看，发现有四个文件
  ![](https://lalala-1252702812.cos.ap-shanghai.myqcloud.com/article/20200227093519.png)
  第一个是命令，第二个是配置，第三个是 man 的命令介绍位置，第四个是配置介绍位置。帮助类型，1 就是命令的，5 就是配置文件的帮助。
  查看配置文件的帮助`man 5 passwd`

- `whatis ls`和`apropos services`
  查看简短信息，有的时候不能用，使用 makewhatis 更新资料库，但比较浪费资源
- `--help` 只列举命令主要选项
- `info` 和 man 差不多
- `help`
  获得 shell 内置命令的帮助信息，找不到路径的命令就是 shell 内置命令，像 cd，umask.这样不能通过 man 来查看，只能通过 help

## 用户管理命令

- `useradd` 添加用户
- `passwd`
- `who` lists the users login
  tty 表示本地登录，
  pts/0 pts 表示远程终端，0 表示终端号，几个终端
- `w` more information of who
  ![](https://lalala-1252702812.cos.ap-shanghai.myqcloud.com/article/20200227100550.png)
  本地时间 开机运行时间（可以看服务器的稳定性） 用户数 负载运行只是（三个时间段的，可以看负载）
  IDLE 累计空闲时间
  PCPU 执行命令占用的 cpu 的时间
  what 执行的命令

## 压缩解压命令

### 压缩格式

`.gz` gzip

- `gzip filename` 压缩命令
- `gunzip filename` 或者 `gzip -d filename` 解压缩

1. gzip 只能压缩文件，不能压缩目录。
2. 并且不保存源文件

`tar` 打包 -`tar -cvf filename of tar（打包后的名字） document（要打包的目录）`
c 打包
v 显示详细信息,打包的详细信息，
f 指定文件名
z 打包的同时压缩，生成.tar.gz 的压缩文件
对目录的打包压缩
**注意顺序 zcvf**

- `tar -zxvf filename` 解包
  x 解打包
  z 解压缩
  **注意顺序**

`zip`
`zip 选项 压缩后文件名 文件或目录`
-r 压缩目录

1. 保留源文件，并且可以压缩目录
2. win 和 lin 通用，rar 不可以
   `unzip filename` 解压缩

`bzip2` gzip 的升级版本
`bzip2 选项 文件`
-k 压缩文件后保留文件

1. 压缩比惊人，压缩大文件用
2. 只能压缩文件
3. 配合 tar，把 j 换成 z 就可以生成.tar.bz2 的格式
4.

`bunzip2 -k 压缩文件` 解压缩
同样把 z 换成 j 就可以解压缩.tar.bz2

## 网络命令

- `write` 给在线用户发送信息，ctrl D 保存结束

  ```bash
  write username
  context
  ```

- `wall` write all 给所有的用户发信息
  wall context
- `ping` 测试网络连通性，发送一个数据包判断回应速度
  `ping -c 3 ip-address` 尝试三次
- `ifconfig` 查看和设置网卡信息
- `mail` 查看和发送邮件地址，现在没用了，系统会发送一些邮件告诉 root 用户现在系统有问题了
- `last` 查看登录信息，
- `lastlog` 所有用户最后登录的时间
- `traceroute` 显示数据包到主机间的路径，查看那个网络节点出现了问题，需要安装
- `netstat` 显示网络相关信息
  -t tcp 协议，握三次手，transimion 打电话
  -u udp 协议，不握手，直接发送，快。user 发短信
  -l 监听
  -r 路由，网关
  -n 显示 ip 和端口号
  -tlun 查看本机开了哪些端口
  ![](https://lalala-1252702812.cos.ap-shanghai.myqcloud.com/article/20200227122645.png)
  proto 协议名字
  recv-Q send-Q 数据包的积压量，0 代表无积压，正常通信
  -an 所有的端口，可以用来看游戏服务器的地址
  local address 就是链接的地址，端口 22 就代表 ssh
  foreign address 就是本机 ssh 的端口地址，
  -rn 当前的网关，最后一行 0，0，0，0 就是

- `setup` redhat 有的，别的一般没有，图形化界面配置网络和防火墙的。DHCP 就是自动获取 ip，需要有人自动分配
- `service network restart` 重启网络服务
- `mount` 挂载设备
  mount [-t 文件系统] 设备文件名称 挂载点
  umount 设备文件名

## 关机重启命令

- `shutdown` 关机命令
  -h now 现在马上关机 -h 20：30 定时关机
  -r 重启
  -c 取消操作
- `reboot` `init6`
- `init`
  0 关机
  1 单用户，修复模式
  2 不完全多用户，不含 NFS 服务，就是文件共享系统
  3 完全多用户
  4 没用
  5 图形界面 X11 代表未知的图形界面
  6 重启
  /etc/inittab init 的配置文件

- `logout`一定要记得退出用户

源码包，脚本安装包（类似 win 的安装程序）
二进制包，预先编译的源码（centos 中是 rpm，Debian 是 deb）

源码包的优点：开源；可以自由选择功能；根据系统编译，执行效率高，更加稳定；卸载方便，直接删除安装目录。

缺点： 安装步骤多，容易出现错误；编译时间长；一旦报错难以解决。

二进制包缺点：依赖；没有源码包灵活；看不到源代码

优点：不需要编译，安装时间短；

rpm 安装时报错，依赖错误，需要的文件结尾时==数字==，就代表缺少‘块’依赖。就需要找网站查找这个块是属于哪个包。

注意区分包全名和包名，包全名包括：报名，版本，发布次数，适合的系统，适合的 cpu 架构

`rpm -ivh 包全名` 安装命令
i 安装 install
v 详细信息
h 安装过程
U 升级
e 卸载，要写包名，因为已经安装过了，系统可以识别到

-q 查询是否安装
-qa 列出所有安装过的包

-qi 查询包的具体信息
-qip 查询未安装包的具体信息

-ql 查询安装包的安装位置
-alp 查询未安装包打算安装的位置

-qf 查询文件属于哪个软件包

-qR 查询未安装的包依赖包
-qRp 查询未安装的包依赖包

-V 校验已经安装的安装包，可以列出修改的项
![](https://lalala-1252702812.cos.ap-shanghai.myqcloud.com/article/20200228105339.png)

## 从包中提取文件，修复软件

`rpm2cpio` 把 rpm 转为 cpio
cpio 从档案文档中提取或者创建文件
`cpio . 文件名`

`rpm2cpio 包全名 | \ cpio -idv ./bin/ls`提取到这个 ls 保存到当前目录中
\ 就是换行符，一行输不下

## yum 在线管理

`yum list` 列出所有的软件包
`yum search` 查找软件包
`yum install` 安装
`yum update 包名` 不加就是升级所有软件，也会升级内核，内核一般不要升级。
`yum remove` 卸载，有可能造成依赖错误，服务器最好不要用 yum，用什么装什么，不要卸载

`yum grouplist` 软件组
`yum groupinstll groupremove`

## RPM

![](https://lalala-1252702812.cos.ap-shanghai.myqcloud.com/article/20200228122129.png)

源码包，一般需要指定位置。建议放到/usr/local/软件名
源码一般放到/usr/local/src

启动执行文件，本质都要用执行文件
/etc/rc.d/init.d/

`service 命令 start` 服务管理命令，源码包安装的 它找不到。

编译源码安装

`./configure --prefix=/usr/local/https` 软件配置和检查，包括配置选项，编译器检查等等都写入 makefile 中
`make` gcc 编译
`make clean` 清空编译的
`make install` 安装

源码包只要删除掉文件，就完全删除了

## 脚本安装包

脚本安装包不是一种类型，常见的就是源码包，只不过包含了一个脚本，方便安装。

`du -sh 文件` 可以看多大

sh 里面是 ctrl 退格 才会使用退格键
